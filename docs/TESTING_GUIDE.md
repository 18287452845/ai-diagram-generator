# AI Diagram Generator - 测试指南

## 🎯 测试目标

本指南帮助您全面测试AI图表生成系统的各项功能，确保系统稳定可用。

---

## 🚀 准备工作

### 1. 启动所有服务

```bash
# Terminal 1 - 启动数据库
cd "D:\My Documents\claude_prj\draw"
docker-compose up -d

# Terminal 2 - 启动后端
cd backend
poetry run uvicorn app.main:app --reload

# Terminal 3 - 启动前端
cd frontend
npm run dev
```

### 2. 验证服务状态

- ✅ 前端: http://localhost:5173
- ✅ 后端API: http://localhost:8000
- ✅ API文档: http://localhost:8000/docs
- ✅ 数据库: `docker-compose ps` 显示healthy

### 3. 配置API密钥

确保 `backend/.env` 中至少配置了一个API密钥：
```bash
ANTHROPIC_API_KEY=sk-ant-...
# 或
OPENAI_API_KEY=sk-proj-...
```

---

## 📋 测试用例

### Test Suite 1: AI生成功能

#### TC1.1 流程图生成（Claude）

**步骤**:
1. 访问 http://localhost:5173
2. 点击"开始创建"
3. 选择图表类型：**流程图**
4. 选择AI引擎：**Claude 3.5**
5. 输入描述：
   ```
   一个用户注册流程图，包含以下步骤：
   1. 用户输入用户名、邮箱、密码
   2. 系统验证信息格式
   3. 检查用户名是否已存在
   4. 如果已存在，提示错误
   5. 如果不存在，创建用户账号
   6. 发送验证邮件
   7. 注册成功，跳转登录页
   ```
6. 点击"生成图表"

**预期结果**:
- ✅ 显示加载状态
- ✅ 10-30秒内生成Mermaid代码
- ✅ 右侧预览面板自动渲染图表
- ✅ 图表包含所有描述的步骤
- ✅ 包含判断分支（菱形节点）

---

#### TC1.2 系统架构图生成（GPT-4）

**步骤**:
1. 选择图表类型：**系统架构图**
2. 选择AI引擎：**GPT-4**
3. 输入描述：
   ```
   一个典型的Web应用架构，包括：
   - 前端：React单页应用
   - API网关：Nginx
   - 后端服务：Python FastAPI，分为用户服务和订单服务
   - 缓存层：Redis
   - 数据库：PostgreSQL主从复制
   - 对象存储：AWS S3
   ```
4. 点击"生成图表"

**预期结果**:
- ✅ 生成的代码使用subgraph组织不同层次
- ✅ 显示清晰的数据流向
- ✅ 包含所有提到的组件

---

#### TC1.3 时序图生成

**描述输入**:
```
用户登录的时序图：
1. 用户在前端输入用户名密码
2. 前端发送POST请求到后端/api/login
3. 后端验证用户名密码
4. 后端查询数据库获取用户信息
5. 数据库返回用户数据
6. 后端生成JWT token
7. 后端返回token给前端
8. 前端保存token并跳转到主页
```

**预期结果**:
- ✅ 包含至少3个参与者（User, Frontend, Backend, Database）
- ✅ 按时间顺序显示交互
- ✅ 包含请求和响应箭头

---

#### TC1.4 ER图生成

**描述输入**:
```
电商系统的ER图，包含：
- 用户表：user_id（主键）、username、email、password
- 商品表：product_id（主键）、name、price、stock
- 订单表：order_id（主键）、user_id（外键）、total_amount、created_at
- 订单明细表：detail_id（主键）、order_id（外键）、product_id（外键）、quantity、price

关系：
- 用户和订单：一对多
- 订单和订单明细：一对多
- 商品和订单明细：一对多
```

**预期结果**:
- ✅ 包含所有4个表
- ✅ 标注主键和外键
- ✅ 显示表之间的关系

---

#### TC1.5 错误处理测试

**步骤**:
1. 不填写描述，直接点击"生成图表"

**预期结果**:
- ✅ 显示错误提示："请输入图表描述"
- ✅ 生成按钮不触发请求

---

### Test Suite 2: 代码编辑功能

#### TC2.1 手动编辑代码

**步骤**:
1. 生成任意图表
2. 在中间的代码编辑器中修改代码：
   ```mermaid
   flowchart TD
       A[开始] --> B[步骤1]
       B --> C[步骤2]
       C --> D[结束]
   ```
3. 观察右侧预览

**预期结果**:
- ✅ 编辑时有语法高亮
- ✅ 输入后500ms自动更新预览
- ✅ 预览正确显示修改后的图表

---

#### TC2.2 语法错误处理

**步骤**:
1. 修改代码为无效语法：
   ```
   flowchart TD
       A[开始 --> B[结束]
   ```
   （注意缺少右括号）
2. 观察预览面板

**预期结果**:
- ✅ 显示错误提示
- ✅ 不崩溃，可以继续编辑

---

#### TC2.3 撤销/重做测试

**步骤**:
1. 生成一个图表
2. 手动修改代码（添加一行）
3. 再次修改代码（添加另一行）
4. 点击"撤销"按钮2次
5. 点击"重做"按钮1次

**预期结果**:
- ✅ 撤销后代码回到之前的状态
- ✅ 重做后代码恢复
- ✅ 预览同步更新
- ✅ 按钮在无法操作时禁用

---

### Test Suite 3: 持久化功能

#### TC3.1 保存新图表

**步骤**:
1. 生成一个图表
2. 修改标题为"测试图表1"
3. 点击"保存"按钮
4. 观察URL变化

**预期结果**:
- ✅ 显示"保存成功"提示
- ✅ URL从 `/editor` 变为 `/editor/{uuid}`
- ✅ 浏览器刷新后图表仍在

---

#### TC3.2 更新已有图表

**步骤**:
1. 在已保存的图表上修改代码
2. 点击"保存"按钮

**预期结果**:
- ✅ 显示"保存成功"提示
- ✅ URL不变
- ✅ 刷新页面，修改已保存

---

#### TC3.3 图表列表查看

**步骤**:
1. 保存2-3个图表
2. 点击左上角"Home"图标
3. 点击"我的图表"

**预期结果**:
- ✅ 显示所有已保存的图表
- ✅ 每个卡片显示标题、类型、更新时间
- ✅ 显示部分代码预览

---

#### TC3.4 从列表加载图表

**步骤**:
1. 在图表列表点击某个图表的"编辑"按钮

**预期结果**:
- ✅ 跳转到编辑器页面
- ✅ 加载正确的图表代码
- ✅ 显示正确的标题
- ✅ 预览正确渲染

---

#### TC3.5 删除图表

**步骤**:
1. 在图表列表点击某个图表的删除按钮
2. 确认删除

**预期结果**:
- ✅ 显示确认对话框
- ✅ 确认后图表从列表移除
- ✅ 图表从数据库删除

---

### Test Suite 4: 导出功能

#### TC4.1 导出SVG

**步骤**:
1. 生成一个图表
2. 点击"导出"按钮
3. 选择"导出为 SVG"

**预期结果**:
- ✅ 浏览器下载一个.svg文件
- ✅ 文件名为图表标题
- ✅ 用浏览器打开SVG，显示正确
- ✅ SVG可以放大缩小无失真

---

#### TC4.2 导出PNG

**步骤**:
1. 导出为 PNG

**预期结果**:
- ✅ 下载一个.png文件
- ✅ PNG图片清晰（2x分辨率）
- ✅ 白色背景
- ✅ 可以插入Word/PPT

---

#### TC4.3 导出代码

**步骤**:
1. 导出代码

**预期结果**:
- ✅ 下载一个.mmd文件
- ✅ 文件内容为纯文本Mermaid代码
- ✅ 可以用文本编辑器打开

---

### Test Suite 5: UI/UX测试

#### TC5.1 响应式测试

**步骤**:
1. 调整浏览器窗口大小
2. 尝试在小屏幕上使用

**预期结果**:
- ✅ 在1920x1080分辨率正常显示
- ✅ 在1366x768分辨率正常显示
- ⚠️ 小于1024宽度可能需要滚动

---

#### TC5.2 加载状态测试

**步骤**:
1. 触发AI生成
2. 观察加载状态

**预期结果**:
- ✅ 生成按钮显示"生成中..."
- ✅ 按钮显示旋转加载图标
- ✅ 按钮禁用，无法重复点击

---

#### TC5.3 导航测试

**步骤**:
1. 从首页 → 编辑器
2. 从编辑器 → 首页（点击Home图标）
3. 从首页 → 图表列表
4. 从图表列表 → 编辑器（点击编辑）
5. 从编辑器 → 图表列表（点击Home再点击我的图表）

**预期结果**:
- ✅ 所有导航流畅
- ✅ URL正确更新
- ✅ 浏览器前进/后退按钮工作正常

---

## 🐛 Bug报告模板

如果发现问题，请记录以下信息：

```
**Bug标题**: [简短描述]

**重现步骤**:
1. 打开...
2. 点击...
3. 输入...
4. 观察到...

**预期行为**:
应该显示/执行...

**实际行为**:
实际显示/执行了...

**环境信息**:
- 浏览器: Chrome 120 / Firefox 121 / ...
- 操作系统: Windows 11 / macOS 14 / ...
- 后端日志: [粘贴相关错误]
- 前端控制台: [粘贴JavaScript错误]

**截图**:
[如果可能，附上截图]
```

---

## ✅ 测试检查清单

### 功能完整性
- [ ] AI生成（Claude）- 至少测试3种图表类型
- [ ] AI生成（GPT-4）- 至少测试1种图表类型
- [ ] 代码手动编辑
- [ ] 实时预览
- [ ] 撤销/重做
- [ ] 保存新图表
- [ ] 更新图表
- [ ] 加载图表
- [ ] 删除图表
- [ ] 导出SVG
- [ ] 导出PNG
- [ ] 导出代码

### 错误处理
- [ ] 空描述提交
- [ ] API错误处理（可以关闭后端测试）
- [ ] 语法错误显示
- [ ] 网络超时处理

### 用户体验
- [ ] 加载状态显示
- [ ] 成功/错误提示
- [ ] 按钮状态（禁用/启用）
- [ ] 导航流畅性

---

## 📊 性能测试（可选）

### 响应时间
- AI生成时间: 建议 < 30秒
- 代码预览刷新: < 1秒
- 保存操作: < 2秒
- 图表加载: < 1秒

### 极限测试
- 生成超长描述（2000字符）
- 编辑超大代码（1000行）
- 创建50+个图表

---

## 🎓 测试技巧

### 快速测试流程
1. **烟雾测试**（5分钟）
   - 生成1个流程图
   - 编辑代码
   - 保存
   - 导出SVG

2. **功能测试**（30分钟）
   - 按Test Suite顺序执行
   - 记录所有问题

3. **探索性测试**（15分钟）
   - 随意点击
   - 尝试边界情况
   - 测试不同浏览器

### 常见问题排查

**Q: AI生成失败**
A: 检查：
- 后端是否运行
- .env中API密钥是否正确
- 网络连接是否正常
- 查看后端日志

**Q: 图表渲染空白**
A: 检查：
- Mermaid代码语法是否正确
- 浏览器控制台是否有JavaScript错误
- 尝试刷新页面

**Q: 保存失败**
A: 检查：
- 数据库是否运行（docker-compose ps）
- 后端是否有数据库连接错误
- 是否运行了数据库迁移

---

**测试文档版本**: v1.0
**最后更新**: 2024-01-20
**测试环境**: 开发环境